# TODO.md - Weave AI 비서 개발 진행 상황

## 🎯 개발 목표
AI 비서 기능을 독립적인 컴포넌트로 개발하여 추후 메인 프로젝트에 통합

## ✅ 완료된 작업
- [x] 프로젝트 초기 구조 분석
- [x] CLAUDE.md 파일 생성 및 프로젝트 가이드라인 작성
- [x] TODO.md 파일 생성
- [x] AI 비서 컴포넌트 설계 및 구현
  - 데이터 추출 기능 (Google Gemini 2.5 Flash Lite 사용 - 멀티모달)
  - 문서 생성 기능 (Google Gemini 2.5 Pro 사용)
- [x] AI 비서 UI 컴포넌트 구현
  - 탭 기반 인터페이스
  - 드래그 앤 드롭 파일 업로드
  - 결과 표시 및 다운로드 기능
- [x] API 라우트 구현 (/api/ai-assistant)
- [x] Google Gemini API 연동 (2.5 Flash Lite & 2.5 Pro)
- [x] 환경 변수 설정 (.env.local)
- [x] 메인 페이지에 AI 비서 컴포넌트 통합
- [x] CLAUDE.md에 개발 방향 업데이트

## 🔄 진행 중인 작업
- 없음

## 🎊 최근 추가된 기능 (2024-01-19)
- [x] 토큰 사용량 추적 및 비용 계산
  - API 호출마다 토큰 사용량 자동 기록
  - 모델별 비용 실시간 계산
  - 사용 통계 시각화
- [x] 마크다운 에디터 통합
  - 생성된 문서 실시간 편집
  - 마크다운 프리뷰 지원
- [x] Word 문서 다운로드
  - 마크다운을 Word(.docx) 형식으로 변환
  - 한국어 폰트 지원
- [x] 템플릿 기반 견적서 시스템 구현
  - 문서 생성도 Gemini 2.5 Flash Lite 모델로 변경
  - 표준 견적서 템플릿 구현
  - 웹 개발, 모바일 앱, 디자인 프로젝트별 템플릿 추가
  - 클라이언트/프로젝트 데이터 자동 적용 기능
  - AI가 템플릿 빈 칸만 채우도록 최적화
- [x] 전문적인 HTML 견적서 프리뷰 기능
  - A4 사이즈 최적화 (210mm x 297mm)
  - 모던하고 전문적인 디자인
  - 인쇄 및 PDF 내보내기 지원
  - 테이블, 리스트, 금액 자동 포맷팅
  - 서명란 및 회사 로고 영역 포함
- [x] 미리보기 종료 버튼 추가
  - 명확한 "닫기" 버튼으로 프리뷰 종료
- [x] PDF 내보내기 기능 구현
  - jsPDF와 html2canvas 라이브러리 사용
  - A4 크기 자동 조정
  - 여러 페이지 지원
  - 고품질 렌더링 (2배 스케일)
- [x] 편집기 저장 기능 개선
  - 저장 버튼 클릭 시 실제 저장 동작
  - 저장 성공 메시지 표시 (2초간)
  - 저장 후 자동으로 HTML 프리뷰 열기
  - 편집된 내용이 프리뷰에 즉시 반영
- [x] 컴포넌트 분리
  - DataExtractor: 데이터 추출 전용 컴포넌트
  - DocumentGenerator: 문서 생성 전용 컴포넌트
  - 각 컴포넌트 독립적으로 사용 가능
  - 추후 다른 페이지에 쉽게 통합 가능
- [x] 문서 종류 선택 기능 추가
  - "견적서 생성"을 "문서 생성"으로 이름 변경
  - 문서 종류 선택 드롭다운 추가 (견적서, 계약서, 청구서)
  - 문서 종류에 따라 템플릿 목록 동적 변경
  - 표준 계약서 템플릿 생성
  - 표준 청구서/세금계산서 템플릿 생성
- [x] 인쇄 최적화 구현
  - Playwright MCP를 활용한 인쇄 기능 테스트
  - A4 용지 크기 최적화 (210mm x 297mm)
  - 인쇄 시 페이지 분리 제어
  - 폰트 크기 및 여백 조정
  - 단일 페이지 출력 최적화
  - 테이블 및 서명란 레이아웃 개선

## 🐛 해결한 오류
- [x] "Event handlers cannot be passed to Client Component props" 오류
  - 원인: Server Component에서 Client Component로 함수 전달
  - 해결: page.tsx에 'use client' 지시어 추가
- [x] API Route 500 Internal Server Error
  - 원인: API 라우트에서 import 문 초기화 오류
  - 해결: 동적 import 사용으로 런타임 모듈 로딩
- [x] Invalid MIME type 오류 (OpenAI Vision API)
  - 원인: OpenAI Vision API는 이미지만 지원
  - 해결: Gemini 2.5 Flash Lite로 변경 (멀티모달 지원)

## 📋 예정된 작업

### 1단계: 설계 및 구조
- [ ] AI 비서 컴포넌트 아키텍처 설계
- [ ] API 인터페이스 정의
- [ ] 상태 관리 구조 설계 (Zustand 활용)

### 2단계: UI 컴포넌트
- [ ] 파일 업로드 컴포넌트
- [ ] 채팅 인터페이스 컴포넌트
- [ ] 결과 표시 컴포넌트
- [ ] 로딩/에러 상태 컴포넌트

### 3단계: API 연동
- [ ] OpenAI API 설정 (GPT-4.1-nano)
- [ ] Google Gemini API 설정 (Gemini-2.5-pro)
- [ ] API 키 관리 및 환경 변수 설정
- [ ] Rate limiting 및 에러 핸들링

### 4단계: 핵심 기능 구현
- [ ] 영수증/문서 업로드 및 이미지 처리
- [ ] OCR 및 데이터 추출 로직
- [ ] 문서 템플릿 시스템
- [ ] 계약서/제안서 생성 로직

### 5단계: 테스트 및 최적화
- [ ] 단위 테스트 작성
- [ ] 통합 테스트
- [ ] 성능 최적화
- [ ] 보안 검토

## 📝 메모
- UI는 최대한 심플하게 구현하여 다른 프로젝트와의 호환성 확보
- 각 기능은 독립적인 컴포넌트로 분리하여 재사용성 극대화
- 타입스크립트 strict 모드 준수

## 🏷️ 버전 기록
- v0.1.0 (2024-01-XX): AI 비서 초기 설계 시작