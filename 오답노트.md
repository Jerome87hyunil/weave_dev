# 오답노트 - Weave 프로젝트

## 1. react-icons 패키지 누락 (2024-08-22)
**에러 종류**: Module not found 
**증상**: `FaBuilding`, `FaSearch` 등 아이콘 import 실패
**해결방법**: `npm install react-icons` 실행하여 패키지 설치

## 2. API 라우트 경로 설정 (2024-08-22)
**에러 종류**: API 엔드포인트 구조
**증상**: `/api/business-info` 호출 시 404 에러
**해결방법**: Next.js App Router에서는 `/app/api/business-info/route.ts` 파일 생성 필요

## 3. 환경변수 설정 (2024-08-22)
**에러 종류**: 환경변수 누락
**증상**: API 키가 없어서 외부 API 호출 실패
**해결방법**: `.env.local` 파일에 `BUSINESS_API_KEY` 추가

## 4. TypeScript 타입 정의 (2024-08-22)
**에러 종류**: TypeScript 타입 에러
**증상**: API 응답 타입이 정의되지 않음
**해결방법**: interface로 `BusinessInfo`, `ApiResponse` 타입 정의

## 5. UUID 패키지 누락 (2024-08-22)
**에러 종류**: Module not found
**증상**: uuid import 실패
**해결방법**: `npm install uuid @types/uuid` 실행하여 패키지 설치

## 6. 이메일 미리보기 모달 구현 (2024-08-23)
**구현 내용**: 이메일 발송 전 미리보기 기능
**핵심 기능**: 
- 실제 발송될 이메일 HTML 렌더링
- 수신자 정보 및 제목 표시
- 인쇄 기능 지원
**해결방법**: EmailPreviewModal 컴포넌트와 /api/email/preview 엔드포인트 생성

## 7. Vercel 배포 TypeScript/ESLint 오류 (2025-08-24) ✅
**에러 종류**: TypeScript 및 ESLint 오류로 인한 빌드 실패
**주요 오류 내용**:
1. **@typescript-eslint/no-explicit-any**: `any` 타입 사용 금지
   - 해결: 구체적인 타입 정의 (interface, type alias 사용)
2. **@typescript-eslint/no-unused-vars**: 사용하지 않는 변수
   - 해결: 불필요한 import 제거, catch 블록에서 error 변수 제거
3. **react-hooks/exhaustive-deps**: useEffect 의존성 배열 누락
   - 해결: useEffect 내부에 함수 정의하여 의존성 문제 해결
4. **@next/next/no-img-element**: Next.js Image 컴포넌트 사용 권장
   - 해결: eslint-disable 주석 추가 (data URL 사용 시)
5. **import/no-anonymous-default-export**: 익명 default export 금지
   - 해결: 변수에 할당 후 export

**해결 방법**:
- API route에서 사용하지 않는 request 파라미터 제거
- any 타입을 구체적인 interface로 교체
- useEffect 내부에 함수 정의하여 의존성 관리
- 사용하지 않는 import와 변수 제거
- catch 블록에서 error 변수 사용하지 않을 경우 제거

## 8. 코드 클린업 및 최적화 (2025-08-25)
**작업 종류**: 코드 정리 및 최적화
**수행 내용**:
1. **console.log 제거**: 프로덕션 코드에서 디버깅용 console.log 문 제거
   - app/page.tsx: 콜백 함수 내 console.log 제거
   - app/contracts/page.tsx: 선택 이벤트 console.log 제거
   - lib/email-service.ts: 이메일 발송 시뮬레이션 console.log 제거
   - components/ai-assistant/AIAssistant.tsx: 저장 성공 메시지 console.log 제거
2. **사용하지 않는 파라미터 정리**: ESLint 경고 해결
   - onDataExtracted, onDocumentGenerated 콜백에서 미사용 파라미터 제거
3. **린팅 검증**: npm run lint로 모든 ESLint 경고/오류 해결 확인
**결과**: 코드 품질 향상 및 빌드 최적화 완료

## 9. 모듈형 컴포넌트 리팩토링 (2025-08-25)
**작업 종류**: 컴포넌트 구조 개선 및 모듈화
**수행 내용**:
1. **탭 네비게이션 컴포넌트화**: TabNavigation 재사용 가능한 컴포넌트 생성
2. **개별 탭 모듈화**: 각 기능을 독립적인 탭 컴포넌트로 분리
   - DataExtractionTab: 데이터 추출 모듈
   - DocumentGenerationTab: 문서 생성 모듈
   - BusinessLookupTab: 사업자 조회 모듈
   - DocumentRequestTab: 문서 요청 모듈
3. **WeaveAssistant 통합 컴포넌트**: 모든 모듈을 조합하는 메인 컴포넌트
   - 탭 선택적 활성화 지원
   - 커스터마이징 가능한 Props
   - 다양한 사용 사례 지원
4. **TypeScript 타입 개선**: any 타입을 구체적인 타입으로 교체
**결과**: 다른 서비스에 쉽게 통합 가능한 모듈형 구조 완성

## 10. Runtime ReferenceError 수정 (2025-08-25)
**에러 종류**: Runtime ReferenceError
**증상**: `dataExtractionConfig is not defined` - index.ts에서 config 참조 오류
**원인**: export 구문으로는 같은 파일 내에서 직접 참조 불가
**해결방법**: 
- export 구문을 import 구문으로 변경
- 각 탭 모듈과 config를 먼저 import한 후 re-export
- 이를 통해 allTabConfigs 배열에서 config 객체 참조 가능

## 11. DocumentRequestSystem 컴포넌트 개선 (2025-08-25)
**에러 종류**: 기능 누락 - 요청 내역에서 메일 미리보기 기능 없음, 업로드된 문서 확인 페이지 없음
**해결방법**:
1. 요청 내역에 "메일 보기" 버튼 추가하여 EmailPreviewModal 재사용
2. 새로운 "업로드 문서" 탭 추가하여 업로드된 문서 확인/승인/거절 기능 구현
3. API 엔드포인트 `/api/email/document-request/[requestId]/documents/[documentId]` 추가
4. email-service.ts에 `updateDocumentStatus`와 `getDocument` 메서드 개선
**주요 변경사항**:
- activeTab 타입에 'uploads' 추가
- handleDocumentApproval 함수 추가로 문서 승인/거절 처리
- 업로드된 문서 탭에서 다운로드, 승인, 거절 기능 구현

## 12. 메일 미리보기 오류 수정 (2025-08-25)
**에러 종류**: "수신자를 찾을 수 없습니다" 오류 및 날짜 형식 불일치
**증상**: 
- 메일 보기 버튼 클릭 시 recipient 찾지 못함
- ISO date string이 input date field와 호환되지 않음
**해결방법**:
- 날짜 형식을 ISO string에서 yyyy-MM-dd 형식으로 변환
- documents 배열 매핑 시 필수 필드 확인
- /api/email/preview 엔드포인트는 이미 존재함을 확인

## 13. 문서 업로드 페이지 구현 (2025-08-25)
**구현 내용**: 고객이 이메일로 받은 토큰으로 문서를 업로드하는 페이지
**주요 기능**:
1. `/upload/[token]` 동적 라우트 페이지 생성
2. 토큰 검증 API (`/api/upload/validate`)
3. 문서 업로드 API (`/api/upload/document`)
4. 파일 업로드 UI 및 상태 관리
**추가 개선사항**:
- email-service.ts에 `getTokenForRequest` 메서드 추가
- `updateDocumentStatus` 메서드 개선하여 uploadedUrl 저장
- 미리보기에서 실제 생성된 토큰 표시